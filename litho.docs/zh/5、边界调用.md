# System Boundary Interface Documentation

This document describes the system's external invocation interfaces, including CLI commands, API endpoints, configuration parameters, and other boundary mechanisms.

## Command Line Interface (CLI)

### cowork

**Description**: AI驱动的协作式软件开发系统主命令

**Source File**: `crates/cowork-cli/src/main.rs`

**Arguments**:

- `config` (string): optional - 配置文件路径（默认：config.toml） (default: `config.toml`)
- `verbose` (boolean): optional - 启用详细日志输出 (default: `false`)
- `stream` (boolean): optional - 启用LLM流式输出（实时显示AI思考过程） (default: `false`)

**Usage Examples**:

```bash
cowork new "创建一个待办事项管理应用"
```

```bash
cowork resume --base session-1234567890
```

```bash
cowork modify "添加用户身份验证功能" --verbose
```

```bash
cowork status --sessions
```

```bash
cowork revert --from design
```

### cowork new

**Description**: 创建新项目

**Source File**: `crates/cowork-cli/src/main.rs`

**Arguments**:

- `idea` (string): required - 项目创意/描述

**Usage Examples**:

```bash
cowork new "创建一个简单的博客系统"
```

```bash
cowork new "开发一个任务管理工具"
```

### cowork resume

**Description**: 恢复现有项目

**Source File**: `crates/cowork-cli/src/main.rs`

**Options**:

- `base, b`(string): optional - 从特定会话ID恢复（可选）。如果省略，默认为最新成功会话；如果没有，尝试最新进行中会话

**Usage Examples**:

```bash
cowork resume
```

```bash
cowork resume --base session-1234567890
```

### cowork revert

**Description**: 从特定阶段恢复项目并重新开始

**Source File**: `crates/cowork-cli/src/main.rs`

**Options**:

- `from, f`(string): required - 重新开始的阶段（prd、design、plan、coding、check、delivery）

**Usage Examples**:

```bash
cowork revert --from design
```

```bash
cowork revert --from coding
```

### cowork modify

**Description**: 对现有项目进行增量修改

**Source File**: `crates/cowork-cli/src/main.rs`

**Arguments**:

- `idea` (string): required - 变更创意/描述

**Options**:

- `base, b`(string): optional - 基础会话ID（默认为最新成功会话）

**Usage Examples**:

```bash
cowork modify "添加用户注册功能"
```

```bash
cowork modify "改进UI界面" --base session-1234567890
```

### cowork status

**Description**: 显示项目状态

**Source File**: `crates/cowork-cli/src/main.rs`

**Options**:

- `sessions, s`(boolean): optional - 显示所有会话 (default: `false`)

**Usage Examples**:

```bash
cowork status
```

```bash
cowork status --sessions
```

### cowork init

**Description**: 初始化配置文件

**Source File**: `crates/cowork-cli/src/main.rs`

**Usage Examples**:

```bash
cowork init
```

## API Interfaces

### POST LLM_API_BASE_URL/v1

**Description**: 调用OpenAI兼容的大语言模型API服务

**Source File**: `crates/cowork-core/src/llm/config.rs`

**Request Format**: OpenAI兼容的JSON格式

**Response Format**: OpenAI兼容的JSON格式

**Authentication**: API_KEY

## Router Routes

### .cowork/sessions/{session_id}/artifacts/

**Description**: 会话产出物存储路径

**Source File**: `crates/cowork-cli/src/main.rs`

**Parameters**:

- `session_id` (string): 会话唯一标识符
### .cowork/sessions/{session_id}/patch/metadata.json

**Description**: 增量修改的补丁元数据文件路径

**Source File**: `crates/cowork-cli/src/main.rs`

**Parameters**:

- `session_id` (string): 会话唯一标识符
### config.toml

**Description**: 默认配置文件路径

**Source File**: `crates/cowork-cli/src/main.rs`

## Integration Suggestions

### LLM服务集成

集成OpenAI兼容的大语言模型API服务，支持自定义端点配置和速率限制

**Example Code**:

```
// 创建LLM客户端配置
let openai_config = OpenAIConfig::compatible(
    &config.api_key,
    &config.api_base_url,
    &config.model_name,
);

// 创建带速率限制的客户端
let client = OpenAIClient::new(openai_config)?;
let rate_limited_client = RateLimitedLlm::with_default_delay(Arc::new(client));
```

**Best Practices**:

- 使用环境变量存储API密钥，避免硬编码
- 实现速率限制机制，确保API调用频率符合服务商限制
- 支持多个OpenAI兼容的API提供商
- 配置合理的超时和重试机制

### 文件系统集成

管理项目文件、会话数据和产出物的本地存储

**Example Code**:

```
// 收集项目文件指纹用于变更检测
fn collect_project_file_fingerprints() -> Result<HashMap<String, (u64, u64)>> {
    let mut map = HashMap::new();
    for entry in WalkDir::new(".").follow_links(false) {
        // 过滤忽略路径并收集文件元数据
    }
    Ok(map)
}

// 差异分析文件变更
fn diff_project_files(before: &HashMap<String, (u64, u64)>, 
                     after: &HashMap<String, (u64, u64)>) 
                     -> (Vec<String>, Vec<String>, Vec<String>) {
    // 识别新增、修改和删除的文件
}
```

**Best Practices**:

- 实现文件变更检测机制，支持增量修改
- 使用合理的忽略模式避免处理系统文件和构建产物
- 确保文件操作的原子性和错误恢复能力
- 实现会话数据的版本管理和备份机制

### 会话管理集成

管理AI智能体工作流的会话状态和进度跟踪

**Example Code**:

```
// 创建会话记录
let session_record = SessionRecord {
    session_id: session_id.clone(),
    session_type: SessionType::New,
    created_at: chrono::Utc::now(),
    completed_at: None,
    status: SessionStatus::InProgress,
    base_session_id: None,
    input_description: idea.clone(),
    change_request_id: None,
};

// 执行AI工作流管道
let mut event_stream = runner.run(user_id, session_id, content).await?;
```

**Best Practices**:

- 实现会话状态的持久化存储
- 支持会话的恢复和继续执行
- 提供会话状态的实时监控和报告
- 实现会话数据的清理和归档策略


---

**Analysis Confidence**: 9.5/10
