# GUI äº¤äº’å¢å¼ºæ–¹æ¡ˆ

## ä¸€ã€è®¾è®¡ç›®æ ‡

1. **æé«˜å·¥ä½œå†…å®¹å¯è§æ€§**ï¼šåœ¨ session ç»´åº¦æŸ¥çœ‹ ideaã€prdã€featuresã€plan ç­‰å†…å®¹
2. **ä»£ç å¯è§†åŒ–**ï¼šåœ¨å†…ç½®ç¼–è¾‘å™¨ä¸­æŸ¥çœ‹ç¼–ç é˜¶æ®µç”Ÿæˆçš„å†…å®¹
3. **å®æ—¶é¢„è§ˆ**ï¼šéªŒæ”¶é˜¶æ®µæä¾› preview åŠŸèƒ½æŸ¥çœ‹å®é™…æ•ˆæœ
4. **ä¸€é”®å¯åŠ¨**ï¼šäº¤ä»˜é˜¶æ®µæä¾›å¯åŠ¨ç¨‹åºçš„èƒ½åŠ›

## äºŒã€ç•Œé¢å¸ƒå±€è®¾è®¡

### 2.1 æ•´ä½“å¸ƒå±€ï¼ˆä¸‰æ å¼ï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Header: Cowork Forge  [Project Selector] [Session Selector]        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                      â”‚                                              â”‚
â”‚  å·¦ä¾§å¯¼èˆªæ         â”‚   ä¸»å·¥ä½œåŒº                                     â”‚
â”‚  (Sidebar)         â”‚   (Main Content)                              â”‚
â”‚                    â”‚                                               â”‚
â”‚  ğŸ“ Sessions       â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  ğŸ“ Artifacts      â”‚   â”‚                                        â”‚ â”‚
â”‚  ğŸ’¬ Chat History   â”‚   â”‚   åŠ¨æ€å†…å®¹åŒºåŸŸ                          â”‚ â”‚
â”‚  ğŸ“‚ Files          â”‚   â”‚   (æ ¹æ®å½“å‰é€‰æ‹©åŠ¨æ€æ˜¾ç¤º)                â”‚ â”‚
â”‚  âš™ï¸  Settings      â”‚   â”‚                                        â”‚ â”‚
â”‚                    â”‚   â”‚                                        â”‚ â”‚
â”‚                    â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                    â”‚                                               â”‚
â”‚                    â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚                    â”‚   â”‚   å¿«é€Ÿæ“ä½œåŒº                            â”‚ â”‚
â”‚                    â”‚   â”‚   (æ ¹æ®å½“å‰é˜¶æ®µåŠ¨æ€æ˜¾ç¤º)                â”‚ â”‚
â”‚                    â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  åº•éƒ¨çŠ¶æ€æ : [å½“å‰é˜¶æ®µ] [å¤„ç†çŠ¶æ€] [æ–‡ä»¶æ•°é‡] [é¢„è§ˆ/å¯åŠ¨æŒ‰é’®]       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 ä¾§è¾¹æ è®¾è®¡

#### Sessions é¢æ¿
```
ğŸ“ Sessions
â”œâ”€â”€ ğŸŸ¢ session-xxx (å½“å‰)
â”‚   â”œâ”€â”€ ğŸ“ idea
â”‚   â”œâ”€â”€ ğŸ“‹ prd
â”‚   â”œâ”€â”€ ğŸ¯ features
â”‚   â”œâ”€â”€ ğŸ“ design
â”‚   â””â”€â”€ ğŸ“‹ plan
â”œâ”€â”€ ğŸŸ¢ session-yyy (å·²å®Œæˆ)
â””â”€â”€ ğŸŸ¡ session-zzz (å¤±è´¥)
```

#### Artifacts é¢æ¿ï¼ˆæ˜¾ç¤ºå½“å‰ session çš„æ‰€æœ‰äº§ç‰©ï¼‰
```
ğŸ“ Artifacts
â”œâ”€â”€ ğŸ“„ idea.md
â”œâ”€â”€ ğŸ“‹ requirements.json
â”œâ”€â”€ ğŸ¯ feature_list.json
â”œâ”€â”€ ğŸ“ design_spec.json
â”œâ”€â”€ ğŸ“‹ implementation_plan.json
â”œâ”€â”€ ğŸ“ src/
â”‚   â”œâ”€â”€ main.rs
â”‚   â””â”€â”€ ...
â””â”€â”€ ğŸ“„ delivery_report.md
```

## ä¸‰ã€æ ¸å¿ƒåŠŸèƒ½æ¨¡å—

### 3.1 å·¥ä½œå†…å®¹æŸ¥çœ‹å™¨

#### åŠŸèƒ½æè¿°
- åœ¨ä¸»å·¥ä½œåŒºå±•ç¤ºå½“å‰ session çš„å„ä¸ªé˜¶æ®µçš„äº§ç‰©
- æ”¯æŒå¤šç§æ ¼å¼ï¼šMarkdownã€JSONã€ä»£ç 
- æ”¯æŒå®æ—¶ç¼–è¾‘ï¼ˆå¯é€‰ï¼‰
- æ”¯æŒç‰ˆæœ¬å¯¹æ¯”

#### ç•Œé¢è®¾è®¡
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“ idea.md                          [ç¼–è¾‘] [å¯¹æ¯”]    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                     â”‚
â”‚ # Project Idea                                      â”‚
â”‚                                                     â”‚
â”‚ ## Problem Statement                                â”‚
â”‚ ...                                                 â”‚
â”‚                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### Tab åˆ‡æ¢è®¾è®¡
```
[Idea] [Requirements] [Features] [Design] [Plan] [Code] [Report]
```

### 3.2 ä»£ç ç¼–è¾‘å™¨é›†æˆ

#### åŠŸèƒ½æè¿°
- ä½¿ç”¨ Monaco Editorï¼ˆVS Code åŒæ¬¾ç¼–è¾‘å™¨ï¼‰
- æ”¯æŒè¯­æ³•é«˜äº®ã€ä»£ç è¡¥å…¨
- æ”¯æŒå¤šæ–‡ä»¶æ ‡ç­¾é¡µ
- æ”¯æŒå®æ—¶ä¿å­˜
- æ”¯æŒæ–‡ä»¶æ ‘å¯¼èˆª

#### ç•Œé¢è®¾è®¡
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“‚ src/                              [+æ–°å»ºæ–‡ä»¶] [åˆ·æ–°]        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                  â”‚                                          â”‚
â”‚ ğŸ“ src/          â”‚ main.rs  *  Cargo.toml  README.md       â”‚
â”‚ â”œâ”€â”€ main.rs      â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚ â”œâ”€â”€ lib.rs       â”‚ â”‚ fn main() {                          â”‚  â”‚
â”‚ â””â”€â”€ ...          â”‚ â”‚     println!("Hello World!");       â”‚  â”‚
â”‚                  â”‚ â”‚     // ...                           â”‚  â”‚
â”‚ ğŸ“ tests/        â”‚ â”‚ }                                    â”‚  â”‚
â”‚ â””â”€â”€ ...          â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                  â”‚                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.3 å®æ—¶é¢„è§ˆåŠŸèƒ½

#### åŠŸèƒ½æè¿°
- è‡ªåŠ¨æ£€æµ‹ Web é¡¹ç›®
- å¯åŠ¨å†…ç½®é¢„è§ˆæœåŠ¡å™¨
- ä½¿ç”¨ iframe åµŒå…¥é¢„è§ˆ
- æ”¯æŒåˆ·æ–°ã€å…¨å±

#### ç•Œé¢è®¾è®¡
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸŒ Preview                              [åˆ·æ–°] [å…¨å±] [åœæ­¢] â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                                                       â”‚  â”‚
â”‚  â”‚         (iframe æ˜¾ç¤ºé¢„è§ˆå†…å®¹)                        â”‚  â”‚
â”‚  â”‚                                                       â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### æŠ€æœ¯æ–¹æ¡ˆ
1. **é¡¹ç›®ç±»å‹æ£€æµ‹**ï¼šæ ¹æ®é¡¹ç›®æ–‡ä»¶åˆ¤æ–­ç±»å‹ï¼ˆHTMLã€Reactã€Vueã€Static ç­‰ï¼‰
2. **é¢„è§ˆæœåŠ¡å™¨**ï¼šä½¿ç”¨å†…ç½® HTTP æœåŠ¡å™¨ï¼ˆRust å®ç°ï¼‰
3. **ç«¯å£ç®¡ç†**ï¼šè‡ªåŠ¨åˆ†é…å¯ç”¨ç«¯å£ï¼ˆ5000-5999ï¼‰
4. **çƒ­æ›´æ–°**ï¼šç›‘æ§æ–‡ä»¶å˜åŒ–ï¼Œè‡ªåŠ¨åˆ·æ–°é¢„è§ˆ

### 3.4 ä¸€é”®å¯åŠ¨åŠŸèƒ½

#### åŠŸèƒ½æè¿°
- æ£€æµ‹é¡¹ç›®å¯åŠ¨å‘½ä»¤
- åœ¨ç»ˆç«¯çª—å£ä¸­è¿è¡Œ
- æ˜¾ç¤ºè¿è¡Œæ—¥å¿—
- æ”¯æŒåœæ­¢

#### ç•Œé¢è®¾è®¡
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸš€ Run Project                              [å¯åŠ¨] [åœæ­¢]    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  [ç»ˆç«¯è¾“å‡ºåŒºåŸŸ]                                             â”‚
â”‚  > cargo run                                               â”‚
â”‚    Compiling...                                            â”‚
â”‚    Finished.                                               â”‚
â”‚    Running `target/debug/myapp`                            â”‚
â”‚    Hello, World!                                           â”‚
â”‚    ^C (stopped)                                             â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## å››ã€æŠ€æœ¯æ–¹æ¡ˆ

### 4.1 åç«¯ Tauri Commands

#### æ–°å¢ Commands

```rust
// 1. è·å– session æ‰€æœ‰ artifacts
#[tauri::command]
async fn get_session_artifacts(session_id: String) -> Result<SessionArtifacts, String>

// 2. è¯»å–æ–‡ä»¶å†…å®¹
#[tauri::command]
async fn read_file_content(session_id: String, file_path: String) -> Result<String, String>

// 3. ä¿å­˜æ–‡ä»¶å†…å®¹
#[tauri::command]
async fn save_file_content(session_id: String, file_path: String, content: String) -> Result<(), String>

// 4. å¯åŠ¨é¢„è§ˆæœåŠ¡å™¨
#[tauri::command]
async fn start_preview(session_id: String) -> Result<PreviewInfo, String>

// 5. åœæ­¢é¢„è§ˆæœåŠ¡å™¨
#[tauri::command]
async fn stop_preview(session_id: String) -> Result<(), String>

// 6. å¯åŠ¨é¡¹ç›®
#[tauri::command]
async fn start_project(session_id: String) -> Result<RunInfo, String>

// 7. åœæ­¢é¡¹ç›®
#[tauri::command]
async fn stop_project(session_id: String) -> Result<(), String>

// 8. è·å–é¡¹ç›®æ–‡ä»¶æ ‘
#[tauri::command]
async fn get_file_tree(session_id: String) -> Result<FileTreeNode, String>

// 9. æ‰§è¡Œé¡¹ç›®å‘½ä»¤ï¼ˆnpm install, cargo build ç­‰ï¼‰
#[tauri::command]
async fn execute_project_command(session_id: String, command: String) -> Result<CommandResult, String>
```

#### æ•°æ®ç»“æ„

```rust
#[derive(Serialize, Deserialize)]
pub struct SessionArtifacts {
    pub session_id: String,
    pub idea: Option<String>,
    pub requirements: Option<Requirements>,
    pub features: Option<FeatureList>,
    pub design: Option<DesignSpec>,
    pub plan: Option<ImplementationPlan>,
    pub code_files: Vec<FileInfo>,
    pub delivery_report: Option<String>,
}

#[derive(Serialize, Deserialize)]
pub struct PreviewInfo {
    pub url: String,
    pub port: u16,
    pub status: PreviewStatus,
}

#[derive(Serialize, Deserialize)]
pub enum PreviewStatus {
    Running,
    Stopped,
    Error(String),
}

#[derive(Serialize, Deserialize)]
pub struct FileTreeNode {
    pub name: String,
    pub path: String,
    pub is_dir: bool,
    pub children: Option<Vec<FileTreeNode>>,
}

#[derive(Serialize, Deserialize)]
pub struct RunInfo {
    pub status: RunStatus,
    pub process_id: Option<u32>,
}

#[derive(Serialize, Deserialize)]
pub enum RunStatus {
    Running,
    Stopped,
    Failed(String),
}
```

### 4.2 é¢„è§ˆæœåŠ¡å™¨å®ç°

#### æŠ€æœ¯é€‰å‹
- ä½¿ç”¨ Rust çš„ `tiny_http` æˆ– `actix-web` åˆ›å»ºè½»é‡çº§æœåŠ¡å™¨
- æ”¯æŒé™æ€æ–‡ä»¶æœåŠ¡
- æ”¯æŒ SPA è·¯ç”±

#### å®ç°æ–¹æ¡ˆ

```rust
// cowork-gui/src-tauri/src/preview_server.rs

use std::sync::{Arc, Mutex};
use std::collections::HashMap;
use tiny_http::{Server, Response, Request};
use std::thread;
use std::path::PathBuf;

pub struct PreviewServerManager {
    servers: Arc<Mutex<HashMap<String, PreviewServer>>>,
}

struct PreviewServer {
    port: u16,
    base_dir: PathBuf,
    handle: Option<thread::JoinHandle<()>>,
}

impl PreviewServerManager {
    pub fn new() -> Self {
        Self {
            servers: Arc::new(Mutex::new(HashMap::new())),
        }
    }
    
    pub fn start(&self, session_id: String, base_dir: PathBuf) -> Result<u16, String> {
        let port = self.find_available_port()?;
        let base_dir_clone = base_dir.clone();
        let session_id_clone = session_id.clone();
        
        let server = Server::http(format!("0.0.0.0:{}", port))
            .map_err(|e| format!("Failed to create server: {}", e))?;
        
        let handle = thread::spawn(move || {
            for request in server.incoming_requests() {
                let response = Self::handle_request(&request, &base_dir_clone);
                let _ = request.respond(response);
            }
        });
        
        let servers = self.servers.lock().unwrap();
        servers.insert(session_id_clone, PreviewServer {
            port,
            base_dir,
            handle: Some(handle),
        });
        
        Ok(port)
    }
    
    pub fn stop(&self, session_id: String) -> Result<(), String> {
        let mut servers = self.servers.lock().unwrap();
        servers.remove(&session_id)
            .ok_or_else(|| "Server not found".to_string())
            .map(|_| ())
    }
    
    fn find_available_port(&self) -> Result<u16, String> {
        for port in 5000..6000 {
            // æ£€æŸ¥ç«¯å£æ˜¯å¦å¯ç”¨
            if Self::is_port_available(port) {
                return Ok(port);
            }
        }
        Err("No available port".to_string())
    }
    
    fn is_port_available(port: u16) -> bool {
        // å®ç°ç«¯å£æ£€æŸ¥é€»è¾‘
        true
    }
    
    fn handle_request(request: &Request, base_dir: &PathBuf) -> Response {
        // å¤„ç†è¯·æ±‚ï¼Œè¿”å›é™æ€æ–‡ä»¶
        Response::from_data(Vec::new())
    }
}
```

### 4.3 é¡¹ç›®è¿è¡Œå™¨

#### æŠ€æœ¯é€‰å‹
- ä½¿ç”¨ `tokio::process::Command` æ‰§è¡Œå‘½ä»¤
- ä½¿ç”¨ `pty` (pseudo-terminal) æä¾›ç»ˆç«¯ä½“éªŒ

#### å®ç°æ–¹æ¡ˆ

```rust
// cowork-gui/src-tauri/src/project_runner.rs

use std::sync::{Arc, Mutex};
use std::collections::HashMap;
use tokio::process::{Command, Child};
use tokio::sync::mpsc;

pub struct ProjectRunner {
    processes: Arc<Mutex<HashMap<String, ProjectProcess>>>,
}

struct ProjectProcess {
    child: Child,
    output_tx: mpsc::UnboundedSender<String>,
}

impl ProjectRunner {
    pub fn new() -> Self {
        Self {
            processes: Arc::new(Mutex::new(HashMap::new())),
        }
    }
    
    pub async fn start(&self, session_id: String, command: String) -> Result<u32, String> {
        let mut child = Command::new("sh")
            .arg("-c")
            .arg(&command)
            .current_dir(format!(".cowork/sessions/{}/code", session_id))
            .stdout(std::process::Stdio::piped())
            .stderr(std::process::Stdio::piped())
            .spawn()
            .map_err(|e| format!("Failed to start: {}", e))?;
        
        let pid = child.id().unwrap();
        
        // å¯åŠ¨è¾“å‡ºè¯»å–ä»»åŠ¡
        let stdout = child.stdout.take().unwrap();
        let stderr = child.stderr.take().unwrap();
        
        // ... è¯»å–è¾“å‡ºå¹¶å‘é€åˆ°å‰ç«¯
        
        let mut processes = self.processes.lock().unwrap();
        processes.insert(session_id, ProjectProcess {
            child,
            output_tx: todo!(),
        });
        
        Ok(pid)
    }
    
    pub async fn stop(&self, session_id: String) -> Result<(), String> {
        let mut processes = self.processes.lock().unwrap();
        let process = processes.remove(&session_id)
            .ok_or_else(|| "Process not found".to_string())?;
        
        process.child.kill()
            .await
            .map_err(|e| format!("Failed to stop: {}", e))?;
        
        Ok(())
    }
}
```

### 4.4 å‰ç«¯ç»„ä»¶è®¾è®¡

#### ä¸»è¦ç»„ä»¶

```jsx
// ArtifactsViewer.jsx - å·¥ä½œå†…å®¹æŸ¥çœ‹å™¨
const ArtifactsViewer = ({ sessionId, activeTab }) => {
  return (
    <div className="artifacts-viewer">
      <Tabs>
        <TabPane tab="Idea" key="idea">
          <MarkdownViewer content={ideaContent} />
        </TabPane>
        <TabPane tab="Requirements" key="requirements">
          <JsonViewer data={requirements} />
        </TabPane>
        <TabPane tab="Features" key="features">
          <FeatureTable features={features} />
        </TabPane>
        <TabPane tab="Design" key="design">
          <DesignViewer design={design} />
        </TabPane>
        <TabPane tab="Plan" key="plan">
          <PlanViewer plan={plan} />
        </TabPane>
      </Tabs>
    </div>
  );
};

// CodeEditor.jsx - ä»£ç ç¼–è¾‘å™¨
const CodeEditor = ({ sessionId, activeFile }) => {
  const [content, setContent] = useState('');
  const editorRef = useRef(null);
  
  return (
    <div className="code-editor">
      <FileTree onFileSelect={handleFileSelect} />
      <Editor
        value={content}
        onChange={handleChange}
        language={getLanguage(activeFile)}
        theme="vs-dark"
        options={{
          minimap: { enabled: true },
          fontSize: 14,
        }}
      />
    </div>
  );
};

// PreviewPanel.jsx - é¢„è§ˆé¢æ¿
const PreviewPanel = ({ sessionId }) => {
  const [previewUrl, setPreviewUrl] = useState(null);
  const [isRunning, setIsRunning] = useState(false);
  
  return (
    <div className="preview-panel">
      <div className="preview-header">
        <h3>ğŸŒ Preview</h3>
        <Button onClick={handleRefresh}>Refresh</Button>
        <Button onClick={handleFullscreen}>Fullscreen</Button>
        <Button onClick={handleStop}>Stop</Button>
      </div>
      <iframe src={previewUrl} className="preview-frame" />
    </div>
  );
};

// ProjectRunnerPanel.jsx - é¡¹ç›®è¿è¡Œå™¨
const ProjectRunnerPanel = ({ sessionId }) => {
  const [logs, setLogs] = useState([]);
  const [isRunning, setIsRunning] = useState(false);
  
  return (
    <div className="runner-panel">
      <div className="runner-header">
        <h3>ğŸš€ Run Project</h3>
        <Button onClick={handleStart}>Start</Button>
        <Button onClick={handleStop}>Stop</Button>
      </div>
      <Terminal logs={logs} />
    </div>
  );
};
```

## äº”ã€äº¤äº’æµç¨‹

### 5.1 Session æŸ¥çœ‹æµç¨‹

```
ç”¨æˆ·ç‚¹å‡» Session
  â†“
ä¾§è¾¹æ æ˜¾ç¤ºè¯¥ Session çš„ Artifacts
  â†“
ä¸»å·¥ä½œåŒºé»˜è®¤æ˜¾ç¤º Idea Tab
  â†“
ç”¨æˆ·ç‚¹å‡»å…¶ä»– Tabï¼ˆRequirements/Features/Design/Planï¼‰
  â†“
åŠ è½½å¯¹åº”æ•°æ®å¹¶æ˜¾ç¤º
  â†“
ç”¨æˆ·å¯ä»¥ç¼–è¾‘ï¼ˆå¯é€‰ï¼‰
  â†“
ç‚¹å‡»ä¿å­˜æŒ‰é’®ï¼Œæ›´æ–°æ–‡ä»¶
```

### 5.2 ç¼–ç é˜¶æ®µæµç¨‹

```
ç¼–ç é˜¶æ®µå¼€å§‹
  â†“
ä¸»å·¥ä½œåŒºåˆ‡æ¢åˆ°ä»£ç ç¼–è¾‘å™¨è§†å›¾
  â†“
æ˜¾ç¤ºé¡¹ç›®æ–‡ä»¶æ ‘
  â†“
ç”¨æˆ·ç‚¹å‡»æ–‡ä»¶
  â†“
åŠ è½½æ–‡ä»¶å†…å®¹åˆ°ç¼–è¾‘å™¨
  â†“
å®æ—¶ä¿å­˜åˆ°åå°
  â†“
æ–‡ä»¶å˜åŒ–æ—¶è‡ªåŠ¨åˆ·æ–°æ–‡ä»¶æ ‘
```

### 5.3 é¢„è§ˆæµç¨‹

```
ç”¨æˆ·ç‚¹å‡»é¢„è§ˆæŒ‰é’®
  â†“
åç«¯æ£€æµ‹é¡¹ç›®ç±»å‹
  â†“
å¯åŠ¨é¢„è§ˆæœåŠ¡å™¨
  â†“
è¿”å›é¢„è§ˆ URL
  â†“
å‰ç«¯åœ¨ iframe ä¸­åŠ è½½ URL
  â†“
ç”¨æˆ·å¯ä»¥åˆ·æ–°ã€å…¨å±æŸ¥çœ‹
  â†“
ç¼–ç é˜¶æ®µï¼Œæ–‡ä»¶å˜åŒ–è‡ªåŠ¨åˆ·æ–°
```

### 5.4 å¯åŠ¨æµç¨‹

```
ç”¨æˆ·ç‚¹å‡»å¯åŠ¨æŒ‰é’®
  â†“
åç«¯æ£€æµ‹é¡¹ç›®å¯åŠ¨å‘½ä»¤
  â†“
åœ¨ç»ˆç«¯ä¸­æ‰§è¡Œå‘½ä»¤
  â†“
å®æ—¶è¾“å‡ºæ—¥å¿—åˆ°å‰ç«¯
  â†“
ç”¨æˆ·å¯ä»¥æŸ¥çœ‹è¿è¡Œç»“æœ
  â†“
ç‚¹å‡»åœæ­¢æŒ‰é’®ç»ˆæ­¢è¿›ç¨‹
```

## å…­ã€ä¸å½±å“ CLI çš„è®¾è®¡åŸåˆ™

### 6.1 æ‰€æœ‰æ–°å¢åŠŸèƒ½éƒ½åœ¨ GUI å±‚

- æ–°å¢çš„ Tauri Commands ä¸å½±å“ CLI
- å‰ç«¯ç»„ä»¶åªåœ¨ GUI ä¸­ä½¿ç”¨
- ä¸ä¿®æ”¹ cowork-core çš„æ ¸å¿ƒé€»è¾‘

### 6.2 ä½¿ç”¨ç°æœ‰å­˜å‚¨ API

- æ‰€æœ‰æ•°æ®è¯»å–ä½¿ç”¨ cowork-core æä¾›çš„ storage API
- ä¸ä¿®æ”¹å­˜å‚¨æ ¼å¼
- ä¸æ·»åŠ æ–°çš„å­˜å‚¨æ–‡ä»¶

### 6.3 é¢„è§ˆå’Œè¿è¡ŒåŠŸèƒ½å¯é€‰

- CLI ç»§ç»­ä¿æŒç®€æ´ï¼Œä¸æä¾›é¢„è§ˆå’Œè¿è¡ŒåŠŸèƒ½
- GUI æä¾›é¢å¤–çš„ä¾¿åˆ©åŠŸèƒ½
- CLI ç”¨æˆ·å¯ä»¥æ‰‹åŠ¨æ‰§è¡Œå¯åŠ¨å‘½ä»¤

## ä¸ƒã€å®æ–½è®¡åˆ’

### Phase 1: åŸºç¡€è®¾æ–½ï¼ˆ1-2å¤©ï¼‰
1. æ–°å¢ Tauri Commands
2. å®ç°æ•°æ®åŠ è½½ API
3. å®ç°æ–‡ä»¶è¯»å–/ä¿å­˜ API

### Phase 2: å·¥ä½œå†…å®¹æŸ¥çœ‹å™¨ï¼ˆ2-3å¤©ï¼‰
1. å®ç° ArtifactsViewer ç»„ä»¶
2. å®ç° MarkdownViewer ç»„ä»¶
3. å®ç° JsonViewer ç»„ä»¶
4. å®ç°å„é˜¶æ®µæŸ¥çœ‹å™¨

### Phase 3: ä»£ç ç¼–è¾‘å™¨ï¼ˆ2-3å¤©ï¼‰
1. é›†æˆ Monaco Editor
2. å®ç°æ–‡ä»¶æ ‘ç»„ä»¶
3. å®ç°å¤šæ–‡ä»¶æ ‡ç­¾é¡µ
4. å®ç°å®æ—¶ä¿å­˜

### Phase 4: é¢„è§ˆåŠŸèƒ½ï¼ˆ2-3å¤©ï¼‰
1. å®ç°é¢„è§ˆæœåŠ¡å™¨
2. å®ç° PreviewPanel ç»„ä»¶
3. å®ç°é¡¹ç›®ç±»å‹æ£€æµ‹
4. å®ç°çƒ­æ›´æ–°

### Phase 5: é¡¹ç›®è¿è¡Œå™¨ï¼ˆ2-3å¤©ï¼‰
1. å®ç°é¡¹ç›®è¿è¡Œå™¨
2. å®ç° RunnerPanel ç»„ä»¶
3. å®ç°ç»ˆç«¯ç»„ä»¶
4. å®ç°å‘½ä»¤æ£€æµ‹

### Phase 6: æµ‹è¯•å’Œä¼˜åŒ–ï¼ˆ2-3å¤©ï¼‰
1. åŠŸèƒ½æµ‹è¯•
2. æ€§èƒ½ä¼˜åŒ–
3. ç”¨æˆ·ä½“éªŒä¼˜åŒ–
4. æ–‡æ¡£å®Œå–„

## å…«ã€æŠ€æœ¯æ ˆ

### å‰ç«¯
- React 18
- Monaco Editorï¼ˆä»£ç ç¼–è¾‘å™¨ï¼‰
- react-markdownï¼ˆMarkdown æ¸²æŸ“ï¼‰
- react-json-viewï¼ˆJSON å¯è§†åŒ–ï¼‰
- Ant Designï¼ˆUI ç»„ä»¶åº“ï¼‰
- Tailwind CSSï¼ˆæ ·å¼ï¼‰

### åç«¯
- Tauri 2.0
- tiny-httpï¼ˆé¢„è§ˆæœåŠ¡å™¨ï¼‰
- tokioï¼ˆå¼‚æ­¥è¿è¡Œæ—¶ï¼‰
- serdeï¼ˆåºåˆ—åŒ–ï¼‰

## ä¹ã€æ³¨æ„äº‹é¡¹

1. **æ€§èƒ½ä¼˜åŒ–**
   - å¤§æ–‡ä»¶ä½¿ç”¨æµå¼åŠ è½½
   - æ–‡ä»¶æ ‘ä½¿ç”¨è™šæ‹Ÿæ»šåŠ¨
   - ç¼–è¾‘å™¨ä½¿ç”¨ Web Worker

2. **å®‰å…¨æ€§**
   - é¢„è§ˆæœåŠ¡å™¨é™åˆ¶è®¿é—®æœ¬åœ°æ–‡ä»¶
   - æ–‡ä»¶è¯»å†™åªé™åˆ¶åœ¨ session ç›®å½•
   - å‘½ä»¤æ‰§è¡Œç™½åå•æœºåˆ¶

3. **å…¼å®¹æ€§**
   - æ”¯æŒå¤šç§é¡¹ç›®ç±»å‹ï¼ˆHTMLã€Reactã€Vueã€Rust ç­‰ï¼‰
   - è·¨å¹³å°æ”¯æŒï¼ˆWindowsã€macOSã€Linuxï¼‰

4. **å¯æ‰©å±•æ€§**
   - é¢„ç•™æ’ä»¶æ¥å£
   - æ”¯æŒè‡ªå®šä¹‰å‘½ä»¤
   - æ”¯æŒè‡ªå®šä¹‰ç¼–è¾‘å™¨ä¸»é¢˜